@page
@model QuestionsAnswers.Web.Pages.QuestionAllModel
@{
    ViewData["Title"] = "All Questions";
}

<h2>All Questions</h2>

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">
        <strong>Error:</strong> @Model.ErrorMessage
    </div>
}

<!-- Table to display all questions -->
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Title</th>
            <th>Asked By</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var question in Model.Questions)
        {
            <tr>
                <td>@question.Title</td>
                <td>@question.UserName</td>
                <td>@question.CreationDate</td>
                <td>
                    <!-- Hidden input for UserQAId -->
                    <input type="hidden" name="UserQAId" value="@question.UserQAId" />

                    @if (!question.IsClosed)
                    {
                        <!-- Button to answer a question -->
                        <button class="btn btn-answer btn-sm" data-bs-toggle="modal" data-bs-target="#answerModal" data-question-id="@question.Id">Answer</button>
                    }

                    <!-- Button to view answers (opens the answers modal) -->
                    <button class="btn btn-view-answers btn-sm" data-bs-toggle="modal" data-bs-target="#viewAnswersModal" data-question-id="@question.Id">View Answers</button>

                    @if (!question.IsClosed)
                    {
                        <!-- Button to close question (visible only to the creator of the question) -->
                        @if (question.UserName == Model.UserId)
                        {
                            <form method="post" action="/QuestionAll/CloseQuestion">
                                <input type="hidden" name="QuestionId" value="@question.Id" />
                                <!-- Button to close the question -->
                                <button type="submit" class="btn btn-sm" style="background-color: #ff8080; color: white; padding: 5px 10px; font-size: 14px; height: auto; width: auto; border-radius: 5px;">
                                    Close Question
                                </button>
                            </form>
                        }
                    }
                </td>
            </tr>
        }
    </tbody>

</table>

<!-- Button to create a new question -->
<button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#createQuestionModal">Create Question</button>


<!-- Modal for answering a question -->
<div class="modal fade" id="answerModal" tabindex="-1" aria-labelledby="answerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="answerModalLabel">Answer Question</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="/Answer/Create">
                    <input type="hidden" id="questionId" name="QuestionId" />
                    <div class="form-group">
                        <label for="answerText">Your Answer</label>
                        <textarea id="answerText" name="AnswerText" class="form-control" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success mt-2">Submit Answer</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal to view answers -->
<div class="modal fade" id="viewAnswersModal" tabindex="-1" aria-labelledby="viewAnswersModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewAnswersModalLabel">View Answers</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="answersList">
                    <!-- Answers will be populated here via JavaScript -->
                </ul>
            </div>
        </div>
    </div>
</div>

